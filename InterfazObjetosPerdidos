import javax.swing.*;
import java.awt.*;
import java.util.HashMap;
import java.util.Map;

public class InterfazObjetosPerdidos extends JFrame {

    private GestorObjetos gestor;

    public InterfazObjetosPerdidos() {
        gestor = new GestorObjetos();

        setTitle("Gestión de Objetos Perdidos");
        setSize(600, 700);
        setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
        setLocationRelativeTo(null);
        setLayout(new BorderLayout());

        JPanel mainPanel = new JPanel();
        mainPanel.setLayout(new BorderLayout());
        mainPanel.setBackground(new Color(245, 245, 245));

        JPanel panelBotones = new JPanel(new GridLayout(6, 1, 15, 15));
        panelBotones.setBorder(BorderFactory.createEmptyBorder(30, 30, 30, 30));
        panelBotones.setBackground(new Color(255, 250, 240));

        JButton btnRegistrar = crearBoton("Registrar Usuario", new Color(204, 102, 255));
        JButton btnIniciarSesion = crearBoton("Iniciar Sesión", new Color(102, 153, 255));
        JButton btnAgregar = crearBoton("Agregar Objeto", new Color(102, 255, 153));
        JButton btnEliminar = crearBoton("Eliminar Objeto", new Color(255, 102, 102));
        JButton btnBuscar = crearBoton("Buscar Objeto", new Color(255, 204, 102));
        JButton btnMostrarTodos = crearBoton("Mostrar Todos", new Color(153, 255, 255));

        btnRegistrar.addActionListener(e -> mostrarFormularioRegistro());
        btnIniciarSesion.addActionListener(e -> iniciarSesion());
        btnAgregar.addActionListener(e -> mostrarFormularioAgregarObjeto());
        btnEliminar.addActionListener(e -> eliminarObjeto());
        btnBuscar.addActionListener(e -> buscarObjeto());
        btnMostrarTodos.addActionListener(e -> mostrarObjetosPorCategoria());

        panelBotones.add(btnRegistrar);
        panelBotones.add(btnIniciarSesion);
        panelBotones.add(btnAgregar);
        panelBotones.add(btnEliminar);
        panelBotones.add(btnBuscar);
        panelBotones.add(btnMostrarTodos);

        mainPanel.add(panelBotones, BorderLayout.CENTER);
        add(mainPanel, BorderLayout.CENTER);

        setVisible(true);
    }

    private JButton crearBoton(String texto, Color colorFondo) {
        JButton button = new JButton(texto);
        button.setFocusPainted(false);
        button.setBackground(colorFondo);
        button.setForeground(Color.WHITE);
        button.setFont(new Font("Verdana", Font.BOLD, 16));
        button.setBorder(BorderFactory.createCompoundBorder(
                BorderFactory.createLineBorder(colorFondo.darker()),
                BorderFactory.createEmptyBorder(15, 25, 15, 25)
        ));
        return button;
    }

    private void mostrarFormularioRegistro() {
        JFrame frame = new JFrame("Registro de Usuario");
        frame.setSize(450, 450);
        frame.setLocationRelativeTo(this);

        JPanel formPanel = new JPanel();
        formPanel.setLayout(new BoxLayout(formPanel, BoxLayout.Y_AXIS));
        formPanel.setBorder(BorderFactory.createEmptyBorder(20, 20, 20, 20));
        formPanel.setBackground(new Color(245, 245, 255));

        JLabel lblNombre = new JLabel("Nombre:");
        JTextField txtNombre = new JTextField(20);

        JLabel lblCorreo = new JLabel("Correo:");
        JTextField txtCorreo = new JTextField(20);

        JLabel lblContrasena = new JLabel("Contraseña:");
        JPasswordField txtContrasena = new JPasswordField(20);

        JLabel lblConfirmarContrasena = new JLabel("Confirmar Contraseña:");
        JPasswordField txtConfirmarContrasena = new JPasswordField(20);

        JButton btnRegistrar = new JButton("Registrar");
        btnRegistrar.setBackground(new Color(102, 204, 102));
        btnRegistrar.setForeground(Color.WHITE);
        btnRegistrar.addActionListener(e -> {
            String nombre = txtNombre.getText();
            String correo = txtCorreo.getText();
            String contrasena = new String(txtContrasena.getPassword());
            String confirmarContrasena = new String(txtConfirmarContrasena.getPassword());

            if (!contrasena.equals(confirmarContrasena)) {
                JOptionPane.showMessageDialog(frame, "Las contraseñas no coinciden.", "Error", JOptionPane.ERROR_MESSAGE);
            } else {
                UsuarioBD.registrarUsuario(nombre, correo, contrasena);
                JOptionPane.showMessageDialog(frame, "Registro completado.", "Éxito", JOptionPane.INFORMATION_MESSAGE);
                frame.dispose();
            }
        });

        formPanel.add(lblNombre);
        formPanel.add(txtNombre);
        formPanel.add(Box.createVerticalStrut(15));
        formPanel.add(lblCorreo);
        formPanel.add(txtCorreo);
        formPanel.add(Box.createVerticalStrut(15));
        formPanel.add(lblContrasena);
        formPanel.add(txtContrasena);
        formPanel.add(Box.createVerticalStrut(15));
        formPanel.add(lblConfirmarContrasena);
        formPanel.add(txtConfirmarContrasena);
        formPanel.add(Box.createVerticalStrut(20));
        formPanel.add(btnRegistrar);

        JScrollPane scrollPane = new JScrollPane(formPanel);
        frame.add(scrollPane);
        frame.setVisible(true);
    }

    private void mostrarFormularioAgregarObjeto() {
        JFrame frame = new JFrame("Agregar Objeto");
        frame.setSize(450, 450);
        frame.setLocationRelativeTo(this);

        JPanel formPanel = new JPanel();
        formPanel.setLayout(new BoxLayout(formPanel, BoxLayout.Y_AXIS));
        formPanel.setBorder(BorderFactory.createEmptyBorder(20, 20, 20, 20));
        formPanel.setBackground(new Color(245, 255, 245));

        JLabel lblNombre = new JLabel("Nombre del Objeto:");
        JTextField txtNombre = new JTextField(20);

        JLabel lblDescripcion = new JLabel("Descripción:");
        JTextField txtDescripcion = new JTextField(20);

        JLabel lblLugar = new JLabel("Lugar Encontrado:");
        JTextField txtLugar = new JTextField(20);

        JLabel lblFecha = new JLabel("Fecha Encontrado (dd/mm/yyyy):");
        JTextField txtFecha = new JTextField(20);

        JLabel lblTipoAccesorio = new JLabel("Tipo de Accesorio:");
        JTextField txtTipoAccesorio = new JTextField(20);

        JLabel lblColor = new JLabel("Color:");
        JTextField txtColor = new JTextField(20);

        JButton btnAgregar = new JButton("Agregar");
        btnAgregar.setBackground(new Color(102, 153, 255));
        btnAgregar.setForeground(Color.WHITE);

        btnAgregar.addActionListener(e -> {
            String nombre = txtNombre.getText();
            String descripcion = txtDescripcion.getText();
            String lugar = txtLugar.getText();
            String fecha = txtFecha.getText();
            String tipoAccesorio = txtTipoAccesorio.getText();
            String color = txtColor.getText();

            gestor.agregarObjeto(new Accesorio(nombre, descripcion, lugar, fecha, tipoAccesorio, color));
            JOptionPane.showMessageDialog(frame, "Objeto agregado con éxito.", "Éxito", JOptionPane.INFORMATION_MESSAGE);
            frame.dispose();
        });

        formPanel.add(lblNombre);
        formPanel.add(txtNombre);
        formPanel.add(Box.createVerticalStrut(15));
        formPanel.add(lblDescripcion);
        formPanel.add(txtDescripcion);
        formPanel.add(Box.createVerticalStrut(15));
        formPanel.add(lblLugar);
        formPanel.add(txtLugar);
        formPanel.add(Box.createVerticalStrut(15));
        formPanel.add(lblFecha);
        formPanel.add(txtFecha);
        formPanel.add(Box.createVerticalStrut(15));
        formPanel.add(lblTipoAccesorio);
        formPanel.add(txtTipoAccesorio);
        formPanel.add(Box.createVerticalStrut(15));
        formPanel.add(lblColor);
        formPanel.add(txtColor);
        formPanel.add(Box.createVerticalStrut(20));
        formPanel.add(btnAgregar);

        JScrollPane scrollPane = new JScrollPane(formPanel);
        frame.add(scrollPane);
        frame.setVisible(true);
    }

    private void mostrarObjetosPorCategoria() {
        JFrame frame = new JFrame("Objetos por Categoría");
        frame.setSize(450, 450);
        frame.setLocationRelativeTo(this);

        JPanel panelObjetos = new JPanel();
        panelObjetos.setLayout(new BoxLayout(panelObjetos, BoxLayout.Y_AXIS));
        panelObjetos.setBackground(new Color(255, 245, 240));

        Map<String, StringBuilder> categorias = new HashMap<>();

        for (ObjetoPerdido obj : gestor.obtenerObjetos()) {
            categorias.computeIfAbsent(obj.getCategoria(), k -> new StringBuilder())
                    .append("- ").append(obj.getNombre()).append("\n");
        }

        for (Map.Entry<String, StringBuilder> entry : categorias.entrySet()) {
            JLabel lblCategoria = new JLabel(entry.getKey() + ":");
            lblCategoria.setFont(new Font("Arial", Font.BOLD, 14));
            lblCategoria.setForeground(new Color(102, 102, 255));

            JTextArea txtObjetos = new JTextArea(entry.getValue().toString());
            txtObjetos.setEditable(false);
            txtObjetos.setBackground(new Color(230, 240, 255));
            txtObjetos.setBorder(BorderFactory.createEmptyBorder(5, 5, 5

